{% load static %}
<!doctype html>
<html lang="en">

<head>
    <title>The Ultimate Win </title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS v5.0.2 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">


    <link rel="stylesheet" href="{% static 'css/style.css' %}">

    <script type="text/javascript">
		function getToken(name) {
			let cookieValue = null;
			if (document.cookie && document.cookie !== '') {
				const cookies = document.cookie.split(';');
				for (let i = 0; i < cookies.length; i++) {
					const cookie = cookies[i].trim();
					// Does this cookie string begin with the name we want?
					if (cookie.substring(0, name.length + 1) === (name + '=')) {
						cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
						break;
					}
				}
			}
			return cookieValue;
		}

		const csrftoken = getToken('csrftoken');



    </script>

</head>

<body>

    <header>
        <nav class="navbar navbar-expand-sm|md|lg|-xl navbar-light bg-light">
            <div class="container justify-content-center">
                <a class="navbar-brand" href="/"> <img src="{% static 'img/logo_ultimate_win.png' %}" class="logo img-fluid " alt=""></a>
            </div>
        </nav>
        <div class="hero p-5" style="background-image: url( '/win/core/static/img/pageheader-shape.png');
        ">
            <div class="container align-self-center">
                <div class="row">
                    <div class="col-md-12">
                        <h3>The Ultimate Win </h3>
                
                    </div>
                </div>
            </div>

        </div>
    </header>


    <main>
        <section class="py-5">
            <div class="container">
                <div class="row py-5">
                    <div class="col-md-12">
                        <img src="{% static 'img/cars.png' %}" class="img-fluid" alt="">
                        <h2 class="title mt-5">Win a car Offer</h2>
                        <p class="text">Sed vivamus ut ut vestibulum mollis id, dictumst scelerisque blandit urna quam
                            arcu, bibendum
                            sed semper sapien. Et orci
                            quia suspendisse aliquam per sit, dis quis nunc urna lectus luctus. Vitae ultricies justo,
                            ornare sudisse
                        </p>
                    </div>
                </div>

                <div class="row py-5 mt-5">
                    <div class="col-md-4">
                        <div class="feature">
                            <img src="./assets/img/1.png" class="img-fluid" alt="">
                            <div class="feature-body">
                                <h3>Uchemba Williams</h3>
                                <p>JACKPOT</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="feature">
                            <img src="./assets/img/1.png" class="img-fluid" alt="">
                            <div class="feature-body">
                                <h3>Uchemba Williams</h3>
                                <p>JACKPOT</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="feature">
                            <img src="./assets/img/1.png" class="img-fluid" alt="">
                            <div class="feature-body">
                                <h3>Uchemba Williams</h3>
                                <p>JACKPOT</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row py-5">
                    <div class="col-md-6">
                        <ul class="style-circle">
                            <li>Lorem ipsum dolor sit amet consectetur adipisicing elit. Modi reiciendis, ducimus
                                incidunt a vel eum.</li>
                            <li>Lorem ipsum dolor sit amet consectetur adipisicing elit. Laborum, reprehenderit.
                                Tempore, asperiores. Omnis sint tempora est quod. Consequatur, architecto accusamus.
                            </li>
                            <li>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Itaque totam maiores
                                perspiciatis, reiciendis assumenda necessitatibus minima culpa.</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <img src="./assets/img/draw.png" alt="">
                    </div>
                </div>

                <div class="row py-5 justify-content-center">
                    <div class="col-md-8 single-jackpot-content text-center">
                        <div class="offer-countdown offer_3 syotimer" id="simple-timer"></div>
                    </div>
                </div>



                <div class="row">
                    <div class="col-md-12 text-center">
                        <button type="button" class="btn btn-blue btn-lg" data-bs-toggle="modal"
                            data-bs-target="#exampleModal">
                            Buy Ticket
                        </button>
                    </div>

                    <!-- Modal -->
                    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    you are about to pay N5000
                                    for Ticket number XXX
                                </div>
                                <div class="modal-footer justify-content-between">
                               
                                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                                        <button  type="button" data-bs-toggle="modal" data-bs-target="#completePayment" class="btn btn-primary">Proceed to Payment</button>
                              
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- Complete Payment  Modal -->
                    <div class="modal fade" id="completePayment" tabindex="-1" aria-labelledby="completePaymentLabel"
                    aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div id="the_modal_title" class="modal-body">
                                Complete the form to proceed
                            </div>
                            <div id="the_modal_body" class="modal-footer justify-content-between">
                                <form id="payment-form">
                                

                                    <script src="https://js.paystack.co/v1/inline.js"></script>

                                    <input id="amount" name="amount" type="hidden" value="{{ticket_amount}}" />

                                    <div class="row mb-3">
                                        <div class="col">
                                          <input type="text" class="form-control" name="fullname" id="fullname" placeholder="Fullname" required aria-label="Fullname">
                                        </div>
                                        <div class="col">
                                          <input type="email" class="form-control" name="email" id="email" placeholder="Email" required aria-label="Email">
                                        </div>

                                     </div>


                                     <div class="row mb-3">
                                        <div class="col">
                                          <input type="text" class="form-control" name="phone" id="phone" placeholder="Phone Number" required aria-label="Phone Number">
                                        </div>
                                        <div class="col">
                                          <input type="text" class="form-control" name="city" id="city" placeholder="City" required aria-label="City">
                                        </div>

                                     </div>


                                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                                    <button type="submit" onclick= "payWithPaystack()" class="btn btn-primary">Proceed to Payment</button>
                                </form>
                                
                            </div>
                        </div>
                    </div>
                </div>





                </div>
            </div>
        </section>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Bootstrap JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
        integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
        integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
        crossorigin="anonymous"></script>


    <script src="{% static 'js/jquery.syotimer.min.js' %}"></script>
    <script src="{% static 'js/main.js' %}"></script>


    
<script type="text/javascript">

    console.log($("input#email").val());
    console.log($("input#phone").val());
    console.log($("input#fullname").val());
    console.log($("input#city").val());

    var formm = document.getElementById("payment-form");

    formm.addEventListener("submit", function (event) {
        event.preventDefault();
    });

    function payWithPaystack() {
        var handler = PaystackPop.setup({
            key: "pk_test_31c5496f8e6e90456d83a0e3b0d8ae79dd64b2f6",
            email: $("input#email").val(),
            amount: $("input#amount").val().concat('00'),
            currency: "NGN",
            metadata: {
                custom_fields: [{
                    display_name: "Mobile Number",
                    variable_name: "mobile_number",
                    value: $("input#phone").val(),
                }]
            },  
            callback: function (response) {
               
                var url = "/complete_payment/"

                fetch(url, {
                    method: 'POST',
                    headers:{
                        'Content-Type':'applicaiton/json',
                        'X-CSRFToken':csrftoken,
                    },

                    body:JSON.stringify({'fullname':$("input#fullname").val(), 'email':$("input#email").val(), 'phone': $("input#phone").val(), 'city': $("input#city").val(), 'reference':response.reference}),
                })
                .then((response) => response.json())
                .then((data) => {
                    console.log(data)
                    if (data['status'] === "success"){
                        
                        document.getElementById('the_modal_title').innerHTML = "Payment Successful";
                        document.getElementById('the_modal_body').innerHTML =  `<div> <h3>Ticket Number</h3> <p> ${data['ticket_number']}  <br> Further instructions has been sent to your email </p>  </div>` ;
                    }else{
                        document.getElementById('the_modal_title').innerHTML = "Payment Failed";
                        document.getElementById('the_modal_body').innerHTML =  `<div> <p>  Please try again !</p>  </div>` ;
                    }
                    
                })


            },

            onClose: function () {
                alert("window closed");
            }
        });

        handler.openIframe();
    }
</script>

    <script>
        $("#simple-timer").syotimer({
            date: new Date(2035, 4, 9, 20, 30),
        });
    </script>

</body>

</html>